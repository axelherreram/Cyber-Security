# üßæ Reporte de Vulnerabilidades
---

## Vulnerabilidad 1 ‚Äî [Critical] Contrase√±as almacenadas en texto plano

**Descripci√≥n del Riesgo**
La tabla `users` almacena contrase√±as sin hashing, permitiendo su recuperaci√≥n directa en caso de filtraci√≥n de la base de datos o acceso no autorizado.

**Impacto**
Compromiso inmediato de todas las cuentas y posible escalada de privilegios. Violaci√≥n de normativas de privacidad (por ejemplo, GDPR, PCI-DSS).

**Remediaci√≥n T√©cnica**

* Implementar hashing robusto y salado (Argon2 o bcrypt) usando funciones nativas del framework (por ejemplo `Hash::make` en Laravel).
* Forzar cambio de contrase√±a en el pr√≥ximo inicio de sesi√≥n y/o enviar proceso de restablecimiento seguro para todas las cuentas.
* Eliminar cualquier almacenamiento de contrase√±as en sesiones o respuestas API.
* Asegurar tr√°nsito con TLS/HTTPS.
* Auditar repositorios y backups para evitar contrase√±as en claro.

**Aspecto ISO/IEC 27001 (2022)**

| Control relevante                     | Recomendaci√≥n para el tratamiento                                                                           |
| ------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| A.5.17 (Informaci√≥n de autenticaci√≥n) | Implementar hashing unidireccional y salado (Argon2/bcrypt). Pol√≠ticas de complejidad, longitud y rotaci√≥n. |
| A.8.24 (Uso de criptograf√≠a)          | Asegurar almacenamiento criptogr√°fico aprobado y protecci√≥n en tr√°nsito (TLS/HTTPS).                        |

---

## Vulnerabilidad 2 ‚Äî [Critical] Rutas API sin autenticaci√≥n ni autorizaci√≥n

**Descripci√≥n del Riesgo**
M√∫ltiples rutas API cr√≠ticas (ej. `/api/auth/admin-login` y m√≥dulos contables) carecen de middleware de autenticaci√≥n/autorizaci√≥n. Se detect√≥ un token de bypass est√°tico (`admin_bypass_token_123`).

**Impacto**
Acceso total a datos y funciones administrativas por actores no autenticados; compromiso completo del sistema.

**Remediaci√≥n T√©cnica**

* Aplicar middleware de autenticaci√≥n (p. ej. Sanctum/Passport en Laravel).
* Implementar autorizaci√≥n por roles y pol√≠ticas (RBAC) y principio de m√≠nimo privilegio.
* Eliminar cualquier token o mecanismo de bypass est√°tico y revisar el historial de commits.
* Revisar y proteger rutas en `backend/routes/web.php` (ej. l√≠neas indicadas: `L49-55`).
* A√±adir logging y alertas a accesos administrativos.

**Aspecto ISO/IEC 27001 (2022)**

| Control relevante                                       | Recomendaci√≥n para el tratamiento                                                       |
| ------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| A.5.15 (Control de acceso) / A.8.2 (Derechos de acceso) | Implementar autenticaci√≥n obligatoria para endpoints sensibles; RBAC.                   |
| A.8.5 (Autenticaci√≥n segura)                            | Usar mecanismos de autenticaci√≥n de alta entrop√≠a; prohibir tokens est√°ticos de bypass. |

---

## Vulnerabilidad 3 ‚Äî [Critical] SQL Injection en m√∫ltiples endpoints

**Descripci√≥n del Riesgo**
Se usan consultas SQL mediante interpolaci√≥n directa de strings (ej. `username = '$username' AND password = '$password'`), permitiendo inyecci√≥n SQL.

**Impacto**
Bypass de autenticaci√≥n, extracci√≥n o manipulaci√≥n masiva de datos (finanzas, usuarios), y posible ejecuci√≥n de comandos a trav√©s de vectores encadenados.

**Remediaci√≥n T√©cnica**

* Reescribir consultas usando Eloquent ORM o Query Builder con par√°metros preparados (prepared statements).
* A√±adir validaci√≥n y saneamiento de entrada en todos los endpoints (whitelisting cuando sea posible).
* Implementar pruebas de seguridad automatizadas (SAST/DAST) que detecten inyecciones.
* Revisar logs y auditor√≠as por indicios de explotaci√≥n.

**Aspecto ISO/IEC 27001 (2022)**

| Control relevante                                      | Recomendaci√≥n para el tratamiento                                       |
| ------------------------------------------------------ | ----------------------------------------------------------------------- |
| A.8.28 (Seguridad del desarrollo, prueba y aceptaci√≥n) | Aplicar principios de desarrollo seguro; usar consultas parametrizadas. |
| A.8.25 (Validaci√≥n de entrada de aplicaci√≥n)           | Implementar validaci√≥n, saneamiento y desinfecci√≥n de inputs.           |

---

## Vulnerabilidad 4 ‚Äî [Critical] Ejecuci√≥n Remota de C√≥digo (RCE) v√≠a `eval()`

**Descripci√≥n del Riesgo**
El endpoint `/api/debug/php-execute` ejecuta directamente c√≥digo PHP (`eval($code);`) sin autenticaci√≥n ni validaci√≥n.

**Impacto**
Ejecuci√≥n arbitraria de c√≥digo PHP con privilegios del servidor web. Compromiso total del servidor y riesgo de pivot a otros sistemas.

**Remediaci√≥n T√©cnica**

* **Eliminar completamente** el endpoint y cualquier uso de `eval()` en producci√≥n.
* Mantener funcionalidades de depuraci√≥n √∫nicamente en entornos de desarrollo/QA con controles estrictos.
* Revisar el repositorio para remover c√≥digo de depuraci√≥n antes del despliegue.
* Auditar permisos y asegurar separaci√≥n entre entornos dev/prod.

**Aspecto ISO/IEC 27001 (2022)**

| Control relevante                   | Recomendaci√≥n para el tratamiento                                                    |
| ----------------------------------- | ------------------------------------------------------------------------------------ |
| A.8.9 (Gesti√≥n de la configuraci√≥n) | Prohibir funciones inseguras (eval) en producci√≥n; mantener configuraciones seguras. |
| A.8.21 (Separaci√≥n de entornos)     | Asegurar que c√≥digo de depuraci√≥n no sea accesible en producci√≥n.                    |

---

## Vulnerabilidad 5 ‚Äî [Critical] Ejecuci√≥n Remota de Comandos (RCE) v√≠a `shell_exec()`

**Descripci√≥n del Riesgo**
Endpoints (`/api/debug/execute-command`, `/api/admin/execute`) ejecutan comandos del sistema v√≠a `shell_exec($command . ' 2>&1')` sin sanitizaci√≥n.

**Impacto**
Ejecuci√≥n arbitraria de comandos del SO, exposici√≥n de credenciales, acceso a archivos sensibles y compromiso del servidor.

**Remediaci√≥n T√©cnica**

* **Eliminar** estos endpoints en producci√≥n.
* Si la ejecuci√≥n de comandos es imprescindible para operaciones administrativas, reemplazar por APIs internas seguras con whitelist de comandos y autenticaci√≥n mutua, adem√°s de ejecuci√≥n en contenedores/entornos con privilegios m√≠nimos.
* Auditar permisos del usuario de la aplicaci√≥n (p. ej. `www-data`) y reducir al m√≠nimo necesario.
* Implementar monitoreo y alertas para ejecuciones de comandos inusuales.

**Aspecto ISO/IEC 27001 (2022)**

| Control relevante                                      | Recomendaci√≥n para el tratamiento                                                 |
| ------------------------------------------------------ | --------------------------------------------------------------------------------- |
| A.8.28 (Seguridad del desarrollo, prueba y aceptaci√≥n) | Evitar funciones que ejecuten shells; usar APIs seguras y con menor privilegio.   |
| A.8.4 (Sistema operativo de seguridad)                 | Ejecutar servidor web con m√≠nimos privilegios; limitar capacidad de `shell_exec`. |

---
